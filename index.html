<!DOCTYPE html>
<html lang="en">
<head>
  <title>Shower Presentation Engine</title>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="node_modules/shower-ribbon/styles/screen-16x10.css">

  <link rel="stylesheet" href="css/prism.css">
  <link rel="stylesheet" href="css/prism-fix.css">
  <link rel="stylesheet" href="css/netology.css">
</head>
<body class="shower list">
<header class="caption">
  <h1>Event Emitter</h1>
  <p>2016</p>
</header>
<section class="slide" id="cover">
  <h2>Event Emitter</h2>
</section>

<!-- План (begin) -->
<section class="slide">
  <h2>План</h2>

  <ol>
    <li>
      Описание шаблона проектирования Наблюдатель [Observer]
    </li>
    <li>
      Примеры в клиентских библиотеках (<code>addEventListener</code>, <code>jQuery.on</code>)
    </li>
    <li>
      Описание модуля <code>events</code> в Node.js. Класс <code>EventEmitter</code>.
    </li>
    <li>
      Методы экземпляра класса <code>EventEmitter</code>
    </li>
    <li>
      Модули <code>Node.js</code> использующие <code>EventEmitter</code>
    </li>
    <li>Материалы</li>
    <li>Задание</li>
  </ol>
</section>
<!-- План (end) -->


<!-- Описание шаблона проектирования Наблюдатель [Observer] (begin) -->
<section class="slide">
  <h2>Наблюдатель [Observer]</h2>

  <p>было:</p>

  <pre style="font-size: .9em;"><code class="language-javascript line-numbers">
    let user_1, user_2, user_3, user_4, chatApplication;
    /* ... */
    chatApplication.send = function(message) {
      // вызовы метода чтения у всех пользователей
      // должны быть в коде метода `send`
      user_1.read(message);
      user_2.read(message);
      user_3.read(message);
      user_4.read(message);
    };
  </code></pre>

</section>

<section class="slide">
  <h2>Наблюдатель [Observer]</h2>
  <p>стало:</p>

  <pre style="font-size: .8em;"><code class="language-javascript line-numbers">
    chatApplication.on('send',
      (message) => { user_1.read(message); }
    );

    // где-то в другом месте кода
    chatApplication.on('send',
      (message) => { user_2.read(message); }
    );

    // где-то в конце кода
    chatApplication.on('send',
      (message) => { user_4.read(message); }
    );
  </code></pre>

</section>
<section class="slide">
  <h2>Наблюдатель [Observer]</h2>

  <ul>
    <li>уменьшает зависимости в коде;</li>
    <li class="next">позволяет произвольно добавлять и удалять обработчики событий;</li>
    <li class="next">облегчает написание асинхронного кода</li>
  </ul>

</section>
<!-- Описание шаблона проектирования Наблюдатель [Observer] (end) -->


<!-- Примеры в клиентских библиотеках (begin) -->
<section class="slide">
  <h2>Примеры в клиентских библиотеках</h2>

  <h3>js DOM</h3>
  <pre>
        <code class="language-javascript line-numbers">
        let button = document.querySelector('.selector');
        let clickHandler = function(e) { /* код обработчика */ };

        // Подписаться на клик по кнопке
        button.addEventListener('click', clickHandler);

        // Отписаться от клика
        button.removeEventListener('click', clickHandler);
      </code>
      </pre>
</section>
<!-- Примеры в клиентских библиотеках (end) -->

<!-- Примеры в клиентских библиотеках 2 (begin) -->
<section class="slide">
  <h2>Примеры в клиентских библиотеках</h2>

  <p><a href="http://api.jquery.com/on/">jquery.on</a></p>
  <pre>
        <code class="language-javascript line-numbers">
        $(document)
          .on("ajaxSend", function() {
            // показать лоадер
            $("#loading").show();
          })
          .on("ajaxComplete", function() {
            // скрыть лоадер
            $("#loading").hide();
        });
      </code>
      </pre>
</section>
<!-- Примеры в клиентских библиотеках 2 (end) -->

<!-- Node.js (begin) -->
<section class="slide">
  <h2 class="shout">Node.js</h2>
</section>
<!-- Node.js (end) -->

<!-- Класс EventEmitter (begin) -->
<section class="slide">
  <h2>Класс <code>EventEmitter</code></h2>
  <p><a href="https://nodejs.org/dist/latest-v6.x/docs/api/events.html">API Doc: events</a></p>

  <p>свойство <code>defaultMaxListeners</code></p>
  <p>событие <code>newListener</code></p>
</section>
<!-- Класс EventEmitter (end) -->

<!-- Методы экземпляра класса EventEmitter (begin) -->
<section class="slide">
  <h2>Методы экземпляра класса <code>EventEmitter</code></h2>

  <ul>
    <li><code>on</code>, <code>once</code></li>
    <li><code>prependListener</code>, <code>prependOnceListener</code></li>
    <li><code>emit</code></li>
    <li><code>eventNames</code></li>
    <li><code>removeListener</code>, <code>removeAllListeners</code></li>
    <li><code>getMaxListeners</code>, <code>setMaxListeners</code></li>
  </ul>
</section>
<!-- Методы экземпляра класса EventEmitter (end) -->

<!-- emitter.on (begin) -->
<section class="slide">
  <h2>emitter.<code>on</code></h2>
  <p>Добавляет обработчик события, вызываемый <strong>каждый раз</strong> при событии.</p>
  <p>Параметры (<a
    href="https://nodejs.org/dist/latest-v6.x/docs/api/events.html#events_emitter_on_eventname_listener">api</a>):</p>
  <ul >
    <li>{String} имя события, обычно camelCase</li>
    <li>{Function} обработчик (добавляется в конец)</li>
  </ul>

  <pre style="font-size: .8em;"><code class="language-javascript line-numbers">
      const EventEmitter = require('events');
      const myEmitter = new EventEmitter();

      myEmitter.on('myEvent', (data) => {
        console.log(`Произошло событие myEvent, данные: ${data}`);
      });
    </code></pre>
</section>
<!-- emitter.on (end) -->

<!-- emitter.once (begin) -->
<section class="slide">
  <h2>emitter.<code>once</code></h2>
  <p>Тоже, что и <code>emitter.on</code>, но обработчик события будет вызван <strong>один раз</strong>.</p>

  <pre><code class="language-javascript line-numbers">
     myEmitter.once('myEvent', (data) => {
        console.log(`Произошло событие myEvent, ${data}`);
      });

     myEmitter.emit('myEvent', 'Привет, Мир!');
     // console.log: Произошло событие myEvent, Привет, Мир!

     myEmitter.emit('myEvent', 'Еще раз, Привет, Мир!');
     // ничего не произойдет

  </code></pre>
</section>
<!-- emitter.once (end) -->

<!-- emitter.prependListener (begin) -->
<section class="slide">
  <h2>emitter.<code>prependListener</code></h2>
  <p>Тоже, что и<code> emitter.on</code>, но добавляет обработчик перед остальными.</p>

  <pre><code class="language-javascript line-numbers">
    myEmitter.on('myEvent', (data) => {
      console.log(`Произошло событие myEvent, сообщение: ${data.message}`);
    });

    myEmitter.prependListener('myEvent', () => {
      console.log(`Последним добавлен — первым вызван`);
    });
  </code></pre>

  <p>emitter.prependOnceListener — тоже, что и <code>emitter.prependListener</code>, но обработчик вызывается один раз</p>
</section>
<!-- emitter.prependListener (end) -->

<!-- emitter.emit (begin) -->
<section class="slide">
  <h2>emitter.<code>emit</code></h2>
  <p><code>emitter.emit(eventName[, arg1][, arg2][, ...])
  </code></p>
  <p>Вызывает событие <code>eventName</code>, <br> можно передать данные <code>arg1, arg2, ...</code></p>
  <p>Параметры (<a
    href="https://nodejs.org/dist/latest-v6.x/docs/api/events.html#events_emitter_emit_eventname_arg1_arg2">api</a>):</p>
  <ul >
    <li>{String} имя события, обычно camelCase</li>
    <li>{*} данные</li>
  </ul>
</section>

<section class="slide">
  <h2>emitter.<code>emit</code>, пример</h2>

  <pre><code class="language-javascript line-numbers">
    const EventEmitter = require('events');
    const myEmitter = new EventEmitter();


    /**
     * {String} "myEvent" — Имя события
     * {*} "Привет, Мир!" — Данные события
     */
     myEmitter.emit('myEvent', "Привет, Мир!");
  </code></pre>
</section>


<!-- emitter.emit (end) -->



<!-- Модули Node.js использующие EventEmitter (begin) -->
<section class="slide">
  <h2>Модули Node.js, использующие <code>EventEmitter</code></h2>

  <ul>
    <li><strong>http.ClientRequest</strong>:
      <code>"connect"</code>,
      <code>"response"</code>,
      <code>"abort"</code>
    </li>
    <li><strong>net.Server</strong>:
      <code>"connection"</code>,
      <code>"error"</code>,
      <code>"listening"</code>,
      <code>"close"</code>
    </li>
    <li><strong>stream.Readable</strong>:
      <code>"data"</code>,
      <code>"error"</code>,
      <code>"end"</code>,
      <code>"close"</code>
    </li>
    <li><strong>fs.ReadStream</strong>:
      <code>"open"</code>,
      <code>"close"</code>
    </li>
    <li><strong>process</strong></li>
    <li><strong>Worker</strong></li>
  </ul>
</section>
<!-- Модули Node.js использующие EventEmitter (end) -->


<!-- Материалы (begin) -->
<section class="slide">
  <h2>Материалы</h2>

  <p></p>
</section>
<!-- Материалы (end) -->


<!-- Задание (begin) -->
<section class="slide">
  <h2>Задание</h2>

  <p></p>
</section>
<!-- Задание (end) -->

<p class="badge">
  <a href="https://github.com/shower/shower">Fork me on GitHub</a>
</p>
<!--
      To hide progress bar from entire presentation
      just remove “progress” element.
      -->
<div class="progress"></div>
<script src="node_modules/shower-core/shower.min.js"></script>

<script src="js/prism.js?v=2"></script>
</body>
</html>
